# XSpliner Python Implementation and Dash UI

This project provides a Python implementation inspired by the R `xspliner` package and an interactive Dash web application to explore its functionality.

The core idea is to build interpretable models (like Linear Regression) using features transformed by splines derived from the behavior of a more complex, black-box model (like RandomForest).

## Project Structure

```
.
├── xspliner_py/          # Python library for xspliner logic
│   ├── __init__.py
│   ├── splines.py        # Core spline/categorical transformation logic
│   └── transformer.py    # Scikit-learn compatible transformer
├── __data/               # Data directory (contains preem.csv, refinery_margins.csv etc.)
├── plots/                # Output directory for plots generated by the Dash app
├── app.py                # The Dash application script
├── requirements.txt      # Python dependencies
├── apply_xspliner.py     # Original script for testing the workflow (optional)
├── xspliner-master/      # Original R package source (ignored by git)
├── *.pdf                 # Reference articles (ignored by git)
└── README.md             # This file
```

## Features

*   **Python Library (`xspliner_py`):**
    *   Calculates Partial Dependence Plots (PDP) from a black-box model.
    *   Fits Generalized Additive Models (GAMs) using `pygam` to approximate PDPs, with options for monotonicity constraints (`auto`, `inc`, `dec`) and automatic comparison to linear fits (`alter='auto'`).
    *   Handles categorical features by calculating average model predictions per category and applying transformations (e.g., quantile binning).
    *   Provides a scikit-learn compatible `XSplinerTransformer`.
*   **Dash Application (`app.py`):**
    *   Upload CSV data.
    *   Select target variable and feature types (numeric/categorical).
    *   Choose black-box (RandomForest, GradientBoosting) and final (LinearRegression, Ridge) models.
    *   Configure XSpliner parameters (PDP resolution, GAM splines/smoothing, categorical merging).
    *   Filter data by a grouping variable (e.g., country).
    *   Define train/test periods using date pickers (time-series aware split).
    *   Run the full workflow.
    *   Visualize results: Metrics (MSE, R2, MAE, MAPE, SMAPE for Train/Test), transformed data head, PDP/Spline plots, Actual vs Fitted/Predicted time series plot.
    *   Includes a parameter reference tab.

## Setup

1.  **Clone the repository (or ensure you have the files).**
2.  **Create a Python environment (recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows use `venv\Scripts\activate`
    ```
3.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```
4.  **Ensure Data:** Make sure your data files (e.g., `preem.csv`, `refinery_margins.csv`) are inside the `__data/` directory (or update paths in `app.py`).

## Running the Dash Application

1.  **Navigate to the project directory** in your terminal.
2.  **Run the app:**
    ```bash
    python app.py
    ```
3.  **Open your web browser** and go to the address provided (usually `http://127.0.0.1:8052/` or similar, check the terminal output for the correct port).

## Usage

1.  **Upload** your CSV file using the upload component.
2.  **Configure** the Target Variable, Feature Types, Models, and XSpliner parameters in the sidebar.
3.  (Optional) Select a **Grouping Column** and **Group Value** to filter the data.
4.  Define the **Train/Test Periods** using the date pickers.
5.  Click **"Run XSpliner Analysis"**.
6.  View the results in the **"Analysis Results"** tab and explanations in the **"Parameter Reference"** tab. 